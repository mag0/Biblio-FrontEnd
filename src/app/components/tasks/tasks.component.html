<div class="container" style="margin-top: 20px;">
  <div class="row">
    <div class="col s12" style="display: flex; justify-content: space-between; align-items: center;">
      <!-- Contenedor del Filtro con Ícono -->
      <div style="display: flex; align-items: center; gap: 10px;">
        <i class="material-icons blue-text" title="Filtrar" style="font-size: 3em;">filter_alt</i>
        <div style="width: 200px;">
          <select id="filterEstado" class="browser-default">
            <option value="" disabled selected>Seleccionar estado</option>
            <option value="pendiente">Pendiente</option>
            <option value="denegada">Denegada</option>
            <option value="revision">En revisión</option>
            <option value="progreso">En progreso</option>
            <option value="completada">Completada</option>
          </select>
        </div>
      </div>

      <div style="display: flex; align-items: center; gap: 10px;" *ngIf="isLibrarian">
        <i class="material-icons blue-text" routerLink="/form-task" title="Agregar" style="font-size: 3em;">add</i>
      </div>
    </div>


    <div class="row" *ngIf="!isLoading && tasks.length > 0">
      <div class="col s12 m12 l12 xl6" *ngFor="let task of tasks; let i = index">
        <div class="card" style="background-color: #B9CFFF;">
          <div class="card-content row" style="padding-bottom: 0px;">
            <div class="col s8">
              <span class="card-title">{{ task.nombre }}</span>
            </div>
            <div class=" estado-box white-text valign-wrapper right-align p3" style="padding: 10px;" [ngClass]="{
            'status-pendiente': task.estado.toLowerCase() === 'pendiente',
            'status-denegado': task.estado.toLowerCase() === 'denegada',
            'status-en-revision': task.estado.toLowerCase() === 'en revisión',
            'status-en-progreso': task.estado.toLowerCase() === 'en progreso',
            'status-completado': task.estado.toLowerCase() === 'completada'
          }">{{ task.estado }}
            </div>
          </div>
          <div class="card-content row" style="padding-top: 0px;">
            <div class=" col s6">
              <p><strong>Creación:</strong> {{ task.fechaCreacion | date:'dd/MM/yyyy' }}</p>
              <p><strong>Vencimiento:</strong> {{ task.fechaLimite | date:'dd/MM/yyyy' }}</p>
            </div>
            <div class="action-buttons right-align">
              <button class="btn-flat blue-text" title="Editar tarea" (click)="navigateToEdit(task.id, $event)"
                *ngIf="isLibrarian">
                <i class="material-icons iconos-tareas">border_color</i>
              </button>
              <button class="btn-flat blue-text" title="Eliminar tarea"
                (click)="askForDeleteConfirmation(task.id, i, task.name, $event)" *ngIf="isLibrarian">
                <i class="material-icons red-text iconos-tareas">delete</i>
              </button>
              <button class="btn-flat" title="Editar tarea" [routerLink]="['/task-detail', task.id]"
                *ngIf="isLibrarian">
                <i class="material-icons blue-text iconos-tareas">visibility</i>
              </button>
              <button class="btn-flat" title="Ver detalles" [routerLink]="['/task-detail', task.id]"
                *ngIf="!isLibrarian">
                <i class="material-icons blue-text iconos-tareas" style="font-size: 3em;">chevron_right</i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Mensaje si no hay tareas -->
<div *ngIf="!isLoading && tasks.length === 0" class="center-align no-tasks-message">
  <i class="material-icons large grey-text text-lighten-1">inbox</i>
  <p class="grey-text">No tienes tareas pendientes.</p>
  <a class="btn waves-effect waves-light blue" routerLink="/form-task">
    Crea tu primera tarea
  </a>
</div>

<!-- Popup de Confirmación -->
<app-confirmation-popup [isVisible]="showConfirmationPopup" [title]="popupTitle" [question]="popupQuestion"
  [primaryActionText]="'Eliminar'" [secondaryActionText]="'Cancelar'" (primaryAction)="confirmDelete()"
  (secondaryAction)="cancelDelete()">
</app-confirmation-popup>