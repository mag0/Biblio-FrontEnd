<div class="container max-w-3xl mx-auto mt-24 bg-white shadow-lg rounded-lg border border-blue-500 p-6">

  <div class="flex items-center justify-center text-blue-500 text-xl font-semibold mb-4">
    <i class="fas" [ngClass]="{'fa-edit': isEditMode, 'fa-plus': !isEditMode}"></i>
    <span class="ml-2">{{isEditMode ? 'Editar Tarea' : 'Crear Nueva Tarea'}}</span>
  </div>

  <form [formGroup]="formTask" (ngSubmit)="onSubmit()">

    <div class="mb-4">
      <label for="name" class="block text-gray-700">Nombre de la Tarea</label>
      <div class="flex items-center border border-gray-300 rounded-md p-2">
        <input id="name" type="text" formControlName="name" class="w-full focus:outline-none">
      </div>
      <span class="text-red-500 text-sm" *ngIf="formTask.get('name')?.invalid && formTask.get('name')?.touched">
        El nombre es requerido.
      </span>
    </div>

    <div class="mb-4">
      <label for="description" class="block text-gray-700">Descripción (Opcional)</label>
      <textarea id="description" formControlName="description"
        class="w-full border border-gray-300 rounded-md p-2 focus:outline-none"></textarea>
      <span class="text-red-500 text-sm"
        *ngIf="formTask.get('description')?.invalid && formTask.get('description')?.touched">
        El email es requerido.
      </span>
    </div>

    <div class="mb-4">
      <label for="fechaLimite" class="block text-gray-700">Fecha Límite (Opcional)</label>
      <input id="limitDate" type="date" formControlName="limitDate"
        class="w-full border border-gray-300 rounded-md p-2 focus:outline-none">
      <span class="text-red-500 text-sm"
        *ngIf="formTask.get('limitDate')?.invalid && formTask.get('limitDate')?.touched">
        El email es requerido.
      </span>
    </div>

    <div class="mb-4" *ngIf="isEditMode">
      <label for="status" class="block text-gray-700">Estado de la tarea</label>
      <select id="status" formControlName="status"
        class="w-full border border-gray-300 rounded-md p-2 focus:outline-none">
        <option value="" disabled>Selecciona un estado</option>
        <option value="Pendiente">Pendiente</option>
        <option value="En Revisión">En Revisión</option>
        <option value="En Proceso">En Proceso</option>
        <option value="Denegada">Denegada</option>
        <option value="Completada">Completada</option>
      </select>
    </div>

    <div class="mb-4 flex items-center gap-2">
      <div class="flex items-center bg-blue-500 text-white px-4 py-2 rounded-md cursor-pointer w-fit"
        onclick="document.getElementById('archivo').click()">
        <span>{{ isEditMode ? 'Cambiar Archivo' : 'Adjuntar Archivo' }}</span>
        <input type="file" id="archivo" (change)="onFileSelected($event)" class="hidden">
      </div>
      <span id="file-name" class="text-gray-700">{{ currentFileName || 'No hay archivo seleccionado' }}</span>
    </div>

    <div class="flex justify-between items-center mt-6">
      <button type="button" (click)="goBack()" class="bg-red-500 text-white py-2 px-4 rounded-md hover:bg-gray-600">
        Volver
      </button>
      <button type="submit" [disabled]="formTask.invalid || uploadStatus === 'uploading'"
        class="bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">
        Guardar Tarea
      </button>
    </div>

  </form>
</div>

<app-confirmation-popup [isVisible]="showSuccessPopup" [title]="successPopupTitle" [question]="successPopupMessage"
  [primaryActionText]="successConfirmButtonText" [secondaryActionText]="successCancelButtonText"
  (primaryAction)="createNewTask()" (secondaryAction)="goToTasks()">
</app-confirmation-popup>